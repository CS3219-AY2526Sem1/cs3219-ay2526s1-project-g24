sequenceDiagram
    participant AuthService as Auth Service (signs JWTs)
    participant JWKS as JWKS Endpoint
    participant OtherService as Other Service (verifies JWTs)

    AuthService->>JWKS: Expose JWKs (kid=1, kid=2, ...)
    OtherService->>JWKS: Fetch JWKS
    JWKS-->>OtherService: Return JWKs (kid=1, kid=2, ...)
    AuthService->>OtherService: Issue JWT (kid=1)
    OtherService->>OtherService: Verify JWT using JWK (kid=1)

    Note over AuthService: Key rotation: add new key (kid=2)
    AuthService->>JWKS: Expose JWKs (kid=1, kid=2)
    AuthService->>OtherService: Issue JWT (kid=2)
    OtherService->>JWKS: Fetch JWKS
    JWKS-->>OtherService: Return JWKs (kid=1, kid=2)
    OtherService->>OtherService: Verify JWT using JWK (kid=2)

    Note over AuthService: After old JWTs expire, remove kid=1
    AuthService->>JWKS: Expose JWKs (kid=2)
    OtherService->>JWKS: Fetch JWKS
    JWKS-->>OtherService: Return JWKs (kid=2)
    OtherService->>OtherService: Verify JWT using JWK (kid=2)
